import{a as _,O as x,D as E,x as $}from"./elementPlus-6d4b871f.js";import{g as D,i as A,F as M}from"./index-13d8bbb1.js";import{i as p,L as S,u as B,a as C,b as L,c as O,d as j,e as F,f as G,g as N,h as Q,j as T,k as I}from"./echarts-0647520d.js";import{E as f,K as y,h as v,j as g,r as h,aJ as R,aQ as U,b as V,k as c,P as n,S as u,Q as W}from"./vendor-9f742c23.js";import"./lodash-742d3967.js";const H={id:"echart-wordcloud",style:{width:"65rem",height:"200px"}},J=f({__name:"wordcloud",setup(k,{expose:r}){let t;return r({loadData(i){const e=Array();i.forEach(s=>{e.push({name:s.message,value:Number(s.sum)})}),t=p(document.getElementById("echart-wordcloud")),t.setOption({tooltip:{show:!0},series:[{type:"wordCloud",right:null,bottom:null,data:e,drawOutOfBound:!0,layoutAnimation:!0,rotationRange:[0,0],textStyle:{fontFamily:"sans-serif",color:function(){return"rgb("+[Math.round(Math.random()*250),Math.round(Math.random()*250),Math.round(Math.random()*250)].join(",")+")"}}}]})}}),y(()=>{t&&(t.dispose(),t=null)}),(i,e)=>(v(),g("div",H))}}),K={class:"danmaku-hot-word"},P=c("div",{id:"danmaku-chart",class:"danmaku-chart"},null,-1),tt=f({__name:"index",setup(k){const r=h(),t=h({total:0,avg_danmaku:0,watched:0,minute_danmaku:Array()}),i=()=>{const a={xAxis:{type:"category",data:Array.from(t.value.minute_danmaku,({countTime:o})=>M(o)),boundaryGap:!1,axisTick:{alignWithLabel:!0}},yAxis:{type:"value",boundaryGap:[0,"100%"],name:"弹幕数"},series:[{name:"弹幕数",data:Array.from(t.value.minute_danmaku,({sum:o})=>o),type:"line",symbol:"rect",sampling:"lttb",smooth:!0,itemStyle:{color:"rgb(255, 70, 131)"},areaStyle:{color:new S(0,0,0,1,[{offset:0,color:"rgb(255, 158, 68)"},{offset:1,color:"rgb(255, 70, 131)"}])}}],tooltip:{trigger:"axis",position:o=>[o[0],"10%"]},title:{text:"每分钟弹幕统计"},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]};return B([C,L,O,j,F,G,N,Q,T,I]),a};let e;const s=R(),m=()=>{const l=i(),a=s.value?"dark":void 0,o=document.getElementById("danmaku-chart");e&&(e.dispose(),e=null),e||(e=p(o,a)),e.setOption(l)};U(s,async l=>{m()});const w=()=>{const l=D("roomid");A({rid:l}).then(a=>{if(a.code!=0)_({title:"提示",message:"获取统计信息失败",type:"error"});else{t.value.avg_danmaku=a.data.avg_danmaku,t.value.total=a.data.total;const o=a.data.hot_word;r.value.loadData(o),t.value.minute_danmaku=a.data.min_danmaku,t.value.watched=a.data.watched,m()}}).catch(a=>{_({title:"提示",message:a||"获取统计信息失败",type:"error"}),console.error(a)})};return V(()=>{w()}),y(()=>{e&&(e.dispose(),e=null)}),(l,a)=>{const o=x,d=E,b=$;return v(),g(W,null,[c("div",null,[n(b,null,{default:u(()=>[n(d,{span:8},{default:u(()=>[n(o,{title:"弹幕数",value:t.value.total},null,8,["value"])]),_:1}),n(d,{span:8},{default:u(()=>[n(o,{title:"平均每分钟弹幕",value:t.value.avg_danmaku},null,8,["value"])]),_:1}),n(d,{span:8},{default:u(()=>[n(o,{title:"观看人数",value:t.value.watched},null,8,["value"])]),_:1})]),_:1}),c("div",K,[n(J,{ref_key:"cloud",ref:r},null,512)])]),P],64)}}});export{tt as default};
