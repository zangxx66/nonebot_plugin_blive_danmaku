import{a,O as e,D as t,x as s}from"./elementPlus-c7747d25.js";import{g as o,i as n,R as l,F as r}from"./index-e0157117.js";import{E as i,aQ as u,aR as d,aS as m,aJ as c,aT as p,aU as g,aV as v,r as f,h,T as y,u as k,aW as _,b,j as x,k as w,P as A,S,Q as j}from"./vendor-38b28640.js";import{i as F,L as E,u as H,a as T,b as z,c as C,d as D,e as G,f as L,g as P,h as R,j as W,k as B}from"./echarts-e70e2381.js";import"./lodash-520df23f.js";const O=i({__name:"wordcloud",setup(a,{expose:e}){u(d),m(d);const t=c();t?p(d):g(d),v(t,(a=>{a?p(d):g(d)}));const s=f({credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,headerFormat:'<span style="font-size: 16px;font-family:sans-serif;"><b>{point.key}</b></span><br>'},title:{text:" ",align:"left"},chart:{spacingLeft:5,spacingRight:5,backgroundColor:"rgba(255, 255, 255,0)"},series:[{type:"wordcloud",name:"次数",spiral:"rectangular",data:Array(),cursor:"pointer",rotation:90,maxFontSize:40,minFontSize:14,style:{fontFamily:"Helvetica Neue,Helvetica,PingFang SC,Hiragino Sans GB,Microsoft YaHei,微软雅黑,Arial,sans-serif",fontWeight:"500"}}]});return e({loadData(a){const e=Array();a.forEach((a=>{e.push({name:a.message,weight:a.sum})})),s.value.series[0].data=e}}),(a,e)=>(h(),y(k(_.Chart),{id:"danmaku-wordcloud",style:{width:"65rem",height:"200px"},options:s.value},null,8,["options"]))}}),Q={class:"danmaku-hot-word"},I=w("div",{id:"danmaku-chart",class:"danmaku-chart"},null,-1),J=i({__name:"index",setup(i){const u=f(),d=f({total:0,avg_danmaku:0,watched:0,hot_word:Array(),minute_danmaku:Array()});let m;const p=c(),g=()=>{const a=(()=>{const a={xAxis:{type:"category",data:Array.from(d.value.minute_danmaku,(({countTime:a})=>r(a))),boundaryGap:!1,axisTick:{alignWithLabel:!0}},yAxis:{type:"value",boundaryGap:[0,"100%"],name:"弹幕数"},series:[{name:"弹幕数",data:Array.from(d.value.minute_danmaku,(({sum:a})=>a)),type:"line",symbol:"rect",sampling:"lttb",smooth:!0,itemStyle:{color:"rgb(255, 70, 131)"},areaStyle:{color:new E(0,0,0,1,[{offset:0,color:"rgb(255, 158, 68)"},{offset:1,color:"rgb(255, 70, 131)"}])}}],tooltip:{trigger:"axis",position:a=>[a[0],"10%"]},title:{text:"每分钟弹幕统计"},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]};return H([T,z,C,D,G,L,P,R,W,B]),a})(),e=p.value?"dark":void 0,t=document.getElementById("danmaku-chart");m&&(m.dispose(),m=null),m||(m=F(t,e)),m.setOption(a)};v(p,(async a=>{g()}));return b((()=>{(()=>{const e=o("roomid");n({rid:e}).then((e=>{if(0!=e.code)a({title:"提示",message:"获取统计信息失败",type:"error"});else{d.value.avg_danmaku=e.data.avg_danmaku,d.value.total=e.data.total;const a=e.data.hot_word;u.value.loadData(a),a.forEach((a=>a.message=l(a.message))),d.value.hot_word=a,d.value.minute_danmaku=e.data.min_danmaku,d.value.watched=e.data.watched,g()}})).catch((e=>{a({title:"提示",message:e||"获取统计信息失败",type:"error"})}))})()})),(a,o)=>{const n=e,l=t,r=s;return h(),x(j,null,[w("div",null,[A(r,null,{default:S((()=>[A(l,{span:8},{default:S((()=>[A(n,{title:"弹幕数",value:d.value.total},null,8,["value"])])),_:1}),A(l,{span:8},{default:S((()=>[A(n,{title:"平均每分钟弹幕",value:d.value.avg_danmaku},null,8,["value"])])),_:1}),A(l,{span:8},{default:S((()=>[A(n,{title:"观看人数",value:d.value.watched},null,8,["value"])])),_:1})])),_:1}),w("div",Q,[A(O,{ref_key:"cloud",ref:u},null,512)])]),I],64)}}});export{J as default};
