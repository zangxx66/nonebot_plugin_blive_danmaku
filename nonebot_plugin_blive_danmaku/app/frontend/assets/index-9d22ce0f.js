import{a,O as e,D as t,x as o}from"./elementPlus-a0efc0c3.js";import{g as s,h as n,R as l,F as r}from"./index-46250209.js";import{w as i,H as d,e as u,h as m}from"./highcharts-0ca2bcfe.js";import{E as c,aG as g,r as p,aN as h,h as f,T as v,u as y,b as k,j as w,k as b,P as _,S as x,Q as A}from"./vendor-e976c2a2.js";import{L as j,u as S,i as E,a as F,b as C,c as D,d as H,e as P,f as z,g as B,h as G,j as I,k as L}from"./echarts-2c727c84.js";import"./lodash-520df23f.js";const R=c({__name:"wordcloud",setup(a,{expose:e}){i(d),u(d),g.locale("zh-cn");const t=p({credits:{enabled:!1},exporting:{enabled:!0,showTable:!1,menuItemDefinitions:{downloadPng:{text:"导出图片",onclick:async function(){const a=document.getElementById("danmaku-wordcloud"),e=await h(a,{scale:1,backgroundColor:null,useCORS:!0,y:40}),t=document.createElement("a");t.download=`wordcloud-image-${g().unix()}.png`,t.href=e.toDataURL("image/png"),t.click(),t.remove()}}},buttons:{contextButton:{menuItems:["downloadPng"]}}},tooltip:{enabled:!0,headerFormat:'<span style="font-size: 16px"><b>{point.key}</b></span><br>'},title:{text:"弹幕词云",align:"left"},chart:{spacingLeft:5,spacingRight:5,backgroundColor:"rgba(255, 255, 255,0)"},series:[{type:"wordcloud",name:"次数",spiral:"rectangular",data:Array(),rotation:90,maxFontSize:40,minFontSize:14,style:{fontFamily:"Helvetica Neue,Helvetica,PingFang SC,Hiragino Sans GB,Microsoft YaHei,微软雅黑,Arial,sans-serif",fontWeight:"500"}}]});return e({loadData(a){const e=Array();a.forEach((a=>{e.push({name:a.message,weight:a.sum})})),t.value.series[0].data=e}}),(a,e)=>(f(),v(y(m.Chart),{id:"danmaku-wordcloud",style:{width:"65rem",height:"200px"},options:t.value},null,8,["options"]))}}),T={class:"danmaku-hot-word"},O=b("div",{id:"danmaku-chart",class:"danmaku-chart"},null,-1),N=c({__name:"index",setup(i){const d=p(),u=p({total:0,avg_danmaku:0,watched:0,hot_word:Array(),minute_danmaku:Array()}),m=()=>{const e=s("roomid");n({rid:e}).then((e=>{if(0!=e.code)a({title:"提示",message:"获取统计信息失败",type:"error"});else{u.value.avg_danmaku=e.data.avg_danmaku,u.value.total=e.data.total;const a=e.data.hot_word;d.value.loadData(a),a.forEach((a=>a.message=l(a.message))),u.value.hot_word=a,u.value.minute_danmaku=e.data.min_danmaku,u.value.watched=e.data.watched,(()=>{const a={xAxis:{type:"category",data:Array.from(u.value.minute_danmaku,(({countTime:a})=>r(a))),boundaryGap:!1,axisTick:{alignWithLabel:!0}},yAxis:{type:"value",boundaryGap:[0,"100%"],name:"弹幕数"},series:[{name:"弹幕数",data:Array.from(u.value.minute_danmaku,(({sum:a})=>a)),type:"line",symbol:"rect",sampling:"lttb",smooth:!0,itemStyle:{color:"rgb(255, 70, 131)"},areaStyle:{color:new j(0,0,0,1,[{offset:0,color:"rgb(255, 158, 68)"},{offset:1,color:"rgb(255, 70, 131)"}])}}],tooltip:{trigger:"axis",position:a=>[a[0],"10%"]},title:{text:"每分钟弹幕统计"},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]};S([F,C,D,H,P,z,B,G,I,L]);const e=document.getElementById("danmaku-chart");E(e).setOption(a)})()}})).catch((e=>{a({title:"提示",message:e||"获取统计信息失败",type:"error"})}))};return k((()=>{m()})),(a,s)=>{const n=e,l=t,r=o;return f(),w(A,null,[b("div",null,[_(r,null,{default:x((()=>[_(l,{span:8},{default:x((()=>[_(n,{title:"弹幕数",value:u.value.total},null,8,["value"])])),_:1}),_(l,{span:8},{default:x((()=>[_(n,{title:"平均每分钟弹幕",value:u.value.avg_danmaku},null,8,["value"])])),_:1}),_(l,{span:8},{default:x((()=>[_(n,{title:"观看人数",value:u.value.watched},null,8,["value"])])),_:1})])),_:1}),b("div",T,[_(R,{ref_key:"cloud",ref:d},null,512)])]),O],64)}}});export{N as default};
